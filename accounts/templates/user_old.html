<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" >
<head>
    <title>Order</title>
    
    <!--<meta http-equiv="X-UA-Compatible" content="IE=edge" />-->
	<!--<meta content='width=device-width, initial-scale=1.0, shrink-to-fit=no' name='viewport' />-->
	<!--<link rel="icon" href="../../static/img/icon.ico" type="image/x-icon"/>-->
	
	<!-- Fonts and icons -->
	<script src="../../static/js/plugin/webfont/webfont.min.js"></script>
	<script>
		WebFont.load({
			google: {"families":["Lato:300,400,700,900"]},
			custom: {"families":["Flaticon", "Font Awesome 5 Solid", "Font Awesome 5 Regular", "Font Awesome 5 Brands", "simple-line-icons"], urls: ['../../static/css/fonts.min.css']},
			active: function() {
				sessionStorage.fonts = true;
			}
		});
	</script>

	<!-- CSS Files -->
	<link rel="stylesheet" href="../../static/css/min.css">
	<link rel="stylesheet" href="../../static/css/atlantis.min.css">
	<!-- CSS Just for demo purpose, don't include it in your project -->
	<link rel="stylesheet" href="../../static/css/demo.css">
</head>
<body>
    <div class="wrapper">
        <div class="wrapper static-sidebar">
            <div class="main-header">
                <!-- Logo Header -->
                <div class="logo-header" data-background-color="blue2">

                    <a href="/" class="logo">
                        <img src="../../static/img/vrxlogo.png" alt="VisionRx lab" style="width:100px;height:50px; padding-top:10px;" />
                    </a>
                    <button style="padding-top:20px;" class="navbar-toggler sidenav-toggler ml-auto" type="button" data-toggle="collapse" data-target="collapse" aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon">
                            <i class="icon-menu"></i>
                        </span>
                    </button>
                    <button style="padding-top:20px;" class="topbar-toggler more"><i class="icon-options-vertical"></i></button>
                    <div style="padding-top:20px;" class="nav-toggle">
                        <button class="btn btn-toggle toggle-sidebar">
                            <i class="icon-menu"></i>
                        </button>
                    </div>
                </div>
                <!-- End Logo Header -->
                <!-- Navbar Header -->
                <nav class="navbar navbar-header navbar-expand-lg" data-background-color="blue2">

                    <div class="container-fluid">
                        <ul class="navbar-nav topbar-nav ml-md-auto align-items-center">

                            <li>
                                <a id="USERNAME_TOP" style="color:white;padding-right:5px;"></a>
                            </li>
                            <!-- Profile top left menu-->
                            <li class="nav-item dropdown hidden-caret">
                                <a class="dropdown-toggle profile-pic" data-toggle="dropdown" href="#" aria-expanded="false">
                                    <div class="avatar-sm">
                                        <img src="../../static/img/user.jpg" alt="..." class="avatar-img rounded-circle" />
                                    </div>
                                </a>
                                <ul class="dropdown-menu dropdown-user animated fadeIn">
                                    <div class="dropdown-user-scroll scrollbar-outer">

                                        <li>
                                            <div class="user-box">
                                                <div class="avatar-lg"><img src="../../static/img/user.jpg" alt="image profile" class="avatar-img rounded" /></div>
                                                <div class="u-text">
                                                    <h4 id="USERNAME">Customer name</h4>
                                                    <p id="EMAIL" class="text-muted">Email</p>
                                                    <!-- 	<a href="profile.html" class="btn btn-xs btn-secondary btn-sm">View Profile</a> -->
                                                </div>
                                            </div>
                                        </li>
                                        <li>
                                            <!--<div class="dropdown-divider"></div>
                                            <a class="dropdown-item" href="#">My Profile</a>
                                            <a class="dropdown-item" href="#">My Balance</a>
                                            <a class="dropdown-item" href="#">Inbox</a>
                                            <div class="dropdown-divider"></div>
                                            <a class="dropdown-item" href="#">Account Setting</a>-->
                                            <div class="dropdown-divider"></div>
                                            <a class="dropdown-item" href="logout">Logout</a>
                                        </li>
                                    </div>
                                </ul>
                            </li>
                        </ul>
                    </div>
                </nav>
                <!-- End Navbar -->
            </div>

            <!-- Sidebar -->
            <div class="sidebar sidebar-style-2">
                <div class="sidebar-wrapper scrollbar scrollbar-inner">
                    <div class="sidebar-content">

                        <ul class="nav nav-primary">
                            <li class="nav-item">
                                <a data-toggle="collapse" href="#dashboard" class="collapsed" aria-expanded="false">
                                    <i class="fas fa-filter"></i>
                                    <p>Filter by</p>
                                    <span class="caret"></span>
                                </a>
                                <div class="collapse" id="dashboard">
                                    <ul class="nav nav-collapse">
                                        <li>
                                            <div class="col-10"><b>Year</b></div>
                                            <div class="col-10">
                                                <select class="form-control input-sm ng-pristine ng-valid ng-valid-required" id="Select1">
                                                    <option value="2021">2021</option>
                                                    <option value="2020">2020</option>
                                                    <option value="2019">2019</option>
                                                </select>
                                            </div>

                                            <div class="col-10"><b>Month</b></div>
                                            <div class="col-10">
                                                <select class="form-control input-sm ng-pristine ng-valid ng-valid-required" id="Select2">
                                                    <option value="01">January</option>
                                                    <option value="02">February</option>
                                                    <option value="03">March</option>
                                                    <option value="04">April</option>
                                                    <option value="05">May</option>
                                                    <option value="06">June</option>
                                                    <option value="07">July</option>
                                                    <option value="08">August</option>
                                                    <option value="09">September</option>
                                                    <option value="10">October</option>
                                                    <option value="11">November</option>
                                                    <option value="12">December</option>
                                                </select>
                                            </div>
                                            <div class="col-10">
                                                &nbsp;
                                            </div>
                                            <div class="col-10">
                                                <button class="btn btn-box-tool ng-hide" type="button" ng-hide="activeTab==&#39;G&#39;" onclick="onMonthWiseFilter()">
                                                    <i class="fa fa-filter"></i>&nbsp;&nbsp;Filter
                                                </button>
                                            </div>
                                        </li>
                                    </ul>
                                </div>
                            </li>
                            <li class="nav-section">
                                <!--<span class="sidebar-mini-icon">
                                    <i class="fa fa-ellipsis-h"></i>
                                </span>
                                <h4 class="text-section">More spasific</h4>-->
                                <div class="dropdown-divider"></div>
                            </li>
                            <li class="nav-item">
                                <a data-toggle="collapse" href="#base">
                                    <i class="fas fa-search"></i>
                                    <p>Searching by</p>
                                    <span class="caret"></span>
                                </a>
                                <div class="collapse" id="base">
                                    <ul class="nav nav-collapse">
                                        <li>
                                            <div class="form-check">
                                                <!--<label>Option</label><br/>-->
                                                <label class="form-radio-label ml-3">
                                                    <input class="form-radio-input" type="radio" id="rb1" onclick="CalendarActivation()" name="optionsRadios" value="1" checked="" />
                                                    <span class="form-radiclass=" form-radio-label=form-radio-label ml-3"o-sign"=ml-3"o-sign">Order Date</span>
                                                </label>
                                                <label class="form-radio-label ml-3">
                                                    <input class="form-radio-input" type="radio" id="rb2" onclick="CalendarActivation()" name="optionsRadios" value="2" />
                                                    <span class="form-radio-sign">Oci number</span>
                                                </label>
                                                <label class="form-radio-label ml-3">
                                                    <input class="form-radio-input" type="radio" id="rb3" onclick="CalendarActivation()" name="optionsRadios" value="3" />
                                                    <span class="form-radio-sign">Reference number</span>
                                                </label>
                                            </div>
                                            <div class="form-group">
                                                <div class="input-icon">
                                                    <input type="text" class="form-control" name="date" placeholder="dd-mm-yyyy" id="enter_val" />
                                                    <span class="input-icon-addon">
                                                        <i class="fa fa-search"></i>
                                                    </span>
                                                </div>
                                            </div>
                                            <div class="col-10">
                                                <button class="btn btn-box-tool ng-hide" type="button" ng-hide="activeTab==&#39;G&#39; " onclick="onSerchFilter()">
                                                    <i class="fa fa-search"></i>&nbsp;&nbsp;Search
                                                </button>
                                            </div>

                                        </li>

                                    </ul>
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="main-panel">
                <div class="content">
                    <div class="page-inner">

                        <div class="card">
                            <!-- <div class="card-header">
                                <div class="card-title">Mini order(s) report</div>
                            </div> -->
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table id="basic-datatables" class="display table table-striped table-hover" style="cursor:pointer;">
                                        <thead>
                                            <tr>
                                                <th>Customer Code</th>
                                                <th>Application Name</th>
                                                <th>Order Number</th>
                                                <th>Oci Number</th>
                                                <th>Cust. Name</th>
                                                <th>Order Date</th>
                                            </tr>
                                        </thead>
                                        <!-- <tfoot>
                                            <tr>
                                                <th>Customer Code</th>
                                                <th>Application Name</th>
                                                <th>Order Number</th>
                                                <th>Oci Number</th>
                                                <th>Cust. Name</th>
                                                <th>Order Date</th>
                                            </tr>
                                        </tfoot> -->

                                    </table>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>

            </div>
            <footer class="footer">
                <div class="container-fluid">
                    <nav class="pull-left">
                        <ul class="nav">
                            <li class="nav-item">
                                <a class="nav-link" href="">
                                    Help
                                </a>
                            </li>
                            <!--<li class="nav-item">
                                <a class="nav-link" href="#">
                                    Help
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="#">
                                    Licenses
                                </a>
                            </li>-->
                        </ul>
                    </nav>
                    <div class="copyright ml-auto">
                        2021, VisionRx lab <!--<i class="fa fa-heart heart text-danger"></i> by <a href="https://www.themekita.com">ThemeKita</a>-->
                    </div>
                </div>
            </footer>
        </div>
    </div>		<!--   Core JS Files   -->
	<script src="../../static/js/core/jquery.3.2.1.min.js"></script>
	<script src="../../static/js/core/popper.min.js"></script>
	<script src="../../static/js/core/bootstrap.min.js"></script>
	<!-- jQuery UI -->
	<script src="../../static/js/plugin/jquery-ui-1.12.1.custom/jquery-ui.min.js"></script>
	<script src="../../static/js/plugin/jquery-ui-touch-punch/jquery.ui.touch-punch.min.js"></script>
	
	<!-- jQuery Scrollbar -->
	<script src="../../static/js/plugin/jquery-scrollbar/jquery.scrollbar.min.js"></script>
	<!-- Datatables -->
	<script src="../../static/js/plugin/datatables/datatables.min.js"></script>
	<!-- Atlantis JS -->
	<script src="../../static/js/atlantis.min.js"></script>
	<!-- Atlantis DEMO methods, don't include it in your project! -->
	<script src="../../static/js/setting-demo2.js"></script>
	<script src="../../static/js/jquery.cookie.js"></script>
	<!-- CSS for Date-picker -->
	<link rel="stylesheet" href="../../static/css/bootstrap-datepicker3.css" />
	 <!-- Include Date Range Picker -->
	 <script type="text/javascript" src="../../static/js/bootstrap-datepicker.min.js"></script>
    <script src="../../static/js/plugin/sweetalert/sweetalert.min.js"></script>

	 <script>
		 $(document).ready(function () {
		     if (document.getElementById('rb1').checked) {
		         var date_input = $('input[name="date"]'); //our date input has the name "date"
		         var container = $('.bootstrap-iso form').length > 0 ? $('.bootstrap-iso form').parent() : "body";
		         date_input.datepicker({
		             format: 'dd-mm-yyyy',
		             container: container,
		             todayHighlight: true,
		             autoclose: true,
		         })
		     }
		     else if (document.getElementById('rb2').checked) {

		         element = document.getElementById('enter_val');
		         element.value = '';
		         element.placeholder = "Enter Oci number...";
		         var date_input = $('input[name="date"]');
		         var container = $('.bootstrap-iso form').length > 0 ? $('.bootstrap-iso form').parent() : "body";
		         date_input.datepicker('remove')

		     }
		     else if (document.getElementById('rb3').checked) {

		         element = document.getElementById('enter_val');
		         element.value = '';
		         element.placeholder = "Enter Reference number...";
		         var date_input = $('input[name="date"]');
		         var container = $('.bootstrap-iso form').length > 0 ? $('.bootstrap-iso form').parent() : "body";
		         date_input.datepicker('remove')

		     }
	 })
 </script>
 
	 <script>
		 function CalendarActivation()
		 {
			 if (document.getElementById('rb1').checked) {
 
				 element = document.getElementById('enter_val');
				 element.value = '';
				 element.placeholder = "dd-mm-yyyy";
 
				 var date_input = $('input[name="date"]'); 
				 var container = $('.bootstrap-iso form').length > 0 ? $('.bootstrap-iso form').parent() : "body";
				 date_input.datepicker({
					 format: 'dd-mm-yyyy',
					 container: container,
					 todayHighlight: true,
					 autoclose: true,
				 })
 
			 }
			 else if (document.getElementById('rb2').checked) {

			     element = document.getElementById('enter_val');
			     element.value = '';
			     element.placeholder = "Enter Oci number...";
			     var date_input = $('input[name="date"]');
			     var container = $('.bootstrap-iso form').length > 0 ? $('.bootstrap-iso form').parent() : "body";
			     date_input.datepicker('remove')

			 }
			 else if (document.getElementById('rb3').checked) {

			     element = document.getElementById('enter_val');
			     element.value = '';
			     element.placeholder = "Enter Reference number...";
			     var date_input = $('input[name="date"]');
			     var container = $('.bootstrap-iso form').length > 0 ? $('.bootstrap-iso form').parent() : "body";
			     date_input.datepicker('remove')

			 }
		 }
	 </script>

    <script>
        var csrftoken = $.cookie('csrftoken');

        function csrfSafeMethod(method) {
            // these HTTP methods do not require CSRF protection
            return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
        }

        $.ajaxSetup({
            beforeSend: function (xhr, settings) {
                if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
                    xhr.setRequestHeader("X-CSRFToken", csrftoken);
                }
            }
        });
    </script>
	<script >
		var table = null;
		$(document).ready(function() {
			table = $('#basic-datatables').DataTable({				
				ajax:{
					url: '/api_cast/',
					dataSrc: 'result.Node'
				},
				columns: [ { data: 'customer_code' },
						{ data: 'Application_name' },
						{ data: 'order_nuber' },
						{ data: 'oci_no' },
						{ data: 'cast_name' },
						{ data: 'order_date' }]
			});				

			$(document).ready(function() {
				$.ajax({
					url: '/api_cast/',
					type: 'GET',
					dataType: 'json',
					contentType: 'application/json',
					success: function (data) {
						// alert(data.username);
						// alert(data.email);
						document.getElementById("USERNAME_TOP").innerHTML = data.username;
						document.getElementById("USERNAME").innerHTML = data.username;
                    	document.getElementById("EMAIL").innerHTML = data.email;
					},
				});		
			});
			
			$('#basic-datatables').on('click', 'tr', function(){
			  var data = table.row($(this)).data();
			  localStorage.setItem("editdata", data.oci_no);
			  window.location.href = "prescription";
		   });
			

			$('#multi-filter-select').DataTable( {
				"pageLength": 5,
				initComplete: function () {
					this.api().columns().every( function () {
						var column = this;
						var select = $('<select class="form-control"><option value=""></option></select>')
						.appendTo( $(column.footer()).empty() )
						.on( 'change', function () {
							var val = $.fn.dataTable.util.escapeRegex(
								$(this).val()
								);

							column
							.search( val ? '^'+val+'$' : '', true, false )
							.draw();
						} );

						column.data().unique().sort().each( function ( d, j ) {
							select.append( '<option value="'+d+'">'+d+'</option>' )
						} );
					} );
				}
			});

			// Add Row
			$('#add-row').DataTable({
				"pageLength": 5,
			});

			var action = '<td> <div class="form-button-action"> <button type="button" data-toggle="tooltip" title="" class="btn btn-link btn-primary btn-lg" data-original-title="Edit Task"> <i class="fa fa-edit"></i> </button> <button type="button" data-toggle="tooltip" title="" class="btn btn-link btn-danger" data-original-title="Remove"> <i class="fa fa-times"></i> </button> </div> </td>';

			$('#addRowButton').click(function() {
				$('#add-row').dataTable().fnAddData([
					$("#addName").val(),
					$("#addPosition").val(),
					$("#addOffice").val(),
					action
					]);
				$('#addRowModal').modal('hide');

			});
		});
		function onMonthWiseFilter(){
			var dt= $('#Select1').val()+"-"+$('#Select2').val();
			var postdata = {entry_date: dt};
			$.ajax({
				url: '/api_cast_filter_date/',
				type: 'post',
				dataType: 'json',
				contentType: 'application/json',
				success: function (data) {
					table.destroy();
					table= $('#basic-datatables').DataTable({
						data: data.result.Node,
						columns: [{ data: 'customer_code' },
						{ data: 'Application_name' },
						{ data: 'order_nuber' },
						{ data: 'oci_no' },
						{ data: 'cast_name' },
						{ data: 'order_date' }]
					});
				},
				data: JSON.stringify(postdata)				
			});	
		}
		function onSerchFilter(){
		    var targeturl = null;
		    var dt = $('#enter_val').val();

		        if (document.getElementById('rb1').checked) {
		            var pattern = /^([0-9]{2})-([0-9]{2})-([0-9]{4})$/;

		            if (dt == null || dt == "" || !pattern.test(dt)) {
		                swal('Date should be dd-mm-yyyy format.', {
		                    icon: "error",
		                    title: "Error Alert",
		                    buttons: {
		                        confirm: {
		                            className: 'btn btn-box-tool ng-hide'
		                        }
		                    },
		                });
		            }
		            else {
		                targeturl='/api_cast_by_date/';
		                var dt1= $('#enter_val').val()
		                var postdata = {entry_date: dt};
		            }
		        }
		        else if(document.getElementById('rb2').checked){
		            var pattern = /^[a-zA-Z0-9]{3}(\/)[0-9]{6}(\/)[0-9]{2}$/;

		            var inputRegex = new RegExp(pattern);

		            if (dt == null || dt == "" || !pattern.test(dt)) {
		                swal('Invalid oci number', {
		                    icon: "error",
		                    title: "Error Alert",
		                    buttons: {
		                        confirm: {
		                            className: 'btn btn-box-tool ng-hide'
		                        }
		                    },
		                });
		            }
		            else {
		                targeturl='/api_cast_cdrff/';
		                var dt= $('#enter_val').val();
		                var postdata = {oci_no: dt};
		            }
		        }
		        else if(document.getElementById('rb3').checked){
		            if (dt == null || dt == "") {
		                swal('Empty reference number not allowed.', {
		                    icon: "error",
		                    title: "Error Alert",
		                    buttons: {
		                        confirm: {
		                            className: 'btn btn-box-tool ng-hide'
		                        }
		                    },
		                });
		            }
		            else {
		                targeturl='/api_cast_filter_ref_on/';
		                var dt= $('#enter_val').val();
		                var postdata = {ref_no: dt};
		            }
		        }
			$.ajax({
				url: targeturl,
				type: 'post',
				dataType: 'json',
				contentType: 'application/json',
				success: function (data) {
					table.destroy();
					table= $('#basic-datatables').DataTable({
						data: data.result.Node,
						columns: [{ data: 'customer_code' },
						{ data: 'Application_name' },
						{ data: 'order_nuber' },
						{ data: 'oci_no' },
						{ data: 'cast_name' },
						{ data: 'order_date' }]
					});
				},
				data: JSON.stringify(postdata)				
			});	
		}
	</script>
</body>
</html>


